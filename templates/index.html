<!-- templates/index.html -->
{% extends "base.html" %}

{% block title %}Home - Ballyholme CSSM Helper{% endblock %}

{% block content %}
<h1 class="text-center mb-4">Welcome to Ballyholme CSSM 2025!!! ðŸŽ‰</h1>
<p id="currentUser" class="text-center"></p>

<div id="userSelection" class="text-center" style="display: none;">
    <h3>Select a User</h3>
    <div class="input-group mb-3 justify-content-center">
        <select id="userSelect" class="form-select" style="width: 50%;">
            <option value="">--Select a user--</option>
            {% for user in users %}
                <option value="{{ user }}">{{ user }}</option>
            {% endfor %}
        </select>
        <button onclick="selectUser()" class="btn btn-primary ms-3">Set User</button>
    </div>
</div>

<script>
    async function fetchSelectedUser() {
        const response = await fetch('/get-selected-user');
        const data = await response.json();
        const currentUserEl = document.getElementById('currentUser');
        const userSelection = document.getElementById('userSelection');

        if (data.user) {
            currentUserEl.textContent = `Current User: ${data.user}`;
            // User is logged in, hide selection
            userSelection.style.display = 'none';
        } else {
            currentUserEl.textContent = `No user selected. Please choose below.`;
            userSelection.style.display = 'block';
        }
    }

    async function selectUser() {
        const userName = document.getElementById('userSelect').value;
        if (!userName) return alert("Please select a user!");
        const response = await fetch('/select-user', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ user_name: userName }),
        });
        const data = await response.json();
        alert(data.message);
        // After selecting a user, reload to show nav/logged-in state
        window.location.reload();
    }

    window.onload = fetchSelectedUser;
</script>
{% endblock %}